{"version":3,"file":"/packages/app-property.js","sources":["app-property/property.html","app-property/property_common.js","app-property/property_client.js"],"names":[],"mappings":";;;;;;;;;AACA,0C;AACA,wF;AACA,kB;AACA,oB;AACA,kC;AACA,0C;AACA,gD;AACA,iB;AACA,4G;AACA,8S;AACA,I;;AAEA,+C;AACA,kG;AACA,kB;AACA,mB;AACA,yB;AACA,2B;AACA,uB;AACA,oD;AACA,K;AACA,4B;AACA,oD;AACA,mD;AACA,0D;AACA,yD;AACA,sD;AACA,8B;AACA,iB;AACA,4B;AACA,oB;AACA,oD;AACA,M;AACA,6B;AACA,wD;AACA,M;AACA,uB;AACA,sD;AACA,K;AACA,Y;AACA,I;;;;;;;;;;;;;;;;;;;ACzCA,4B;AACA,2B;AACA,2D;AACA,W;AACA,a;AACA,wB;AACA,4B;AACA,U;AACA,0C;AACA,G;AACA,E;AACA,sD;AACA,6B;AACA,8B;AACA,mB;AACA,qB;AACA,E;AACA,c;AACA,E;;AAEA,gB;AACA,Y;AACA,c;AACA,W;AACA,iB;AACA,gC;AACA,oB;AACA,G;AACA,oC;AACA,E;;AAEA,yB;AACA,oB;AACA,e;AACA,E;AACA,E;;AAEA,kC;AACA,2D;AACA,oB;AACA,gB;AACA,yB;AACA,c;AACA,G;AACA,qB;AACA,oC;AACA,kC;AACA,iB;AACA,yD;AACA,kD;AACA,wB;AACA,+D;AACA,yB;AACA,W;AACA,I;AACA,iE;AACA,c;AACA,6B;AACA,uD;AACA,oC;AACA,O;AACA,W;AACA,6B;AACA,+B;AACA,kD;AACA,I;AACA,uB;AACA,I;AACA,Q;AACA,G;AACA,iC;AACA,+B;AACA,+C;AACA,6D;AACA,E;AACA,G;;;;;;;;;;;;;;;;;;;AC3EA,oC;AACA,oB;AACA,iD;AACA,uB;AACA,c;AACA,a;AACA,I;AACA,K;AACA,E;AACA,G;AACA,mC;AACA,iC;AACA,qB;AACA,kB;AACA,oE;AACA,2B;AACA,oB;AACA,8C;AACA,kB;AACA,6D;AACA,qB;AACA,S;AACA,oB;AACA,iB;AACA,sD;AACA,gB;AACA,K;AACA,I;AACA,iD;AACA,W;AACA,e;AACA,K;AACA,M;AACA,K;AACA,0C;AACA,mC;AACA,G;AACA,G;AACA,kC;AACA,kC;AACA,oC;AACA,G;AACA,E;AACA,G;AACA,2B;AACA,iC;AACA,G;AACA,0B;AACA,S;AACA,qB;AACA,4C;AACA,G;AACA,G;AACA,G","sourcesContent":["\nTemplate.__checkName(\"appPropertyEditor\");\nTemplate[\"appPropertyEditor\"] = new Template(\"Template.appPropertyEditor\", (function() {\n  var view = this;\n  return HTML.FORM({\n    \"class\": \"app-property-editor\"\n  }, \"\\n        \", Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"props\"));\n  }, function() {\n    return [ \"\\n        \", Spacebars.include(view.lookupTemplate(\"appPropertyEditorField\")), \"\\n        \" ];\n  }), HTML.Raw('\\n        <button type=\"submit\" class=\"save btn btn-primary\">\\n        <span class=\"fa fa-save\"></span>\\n        Submit\\n        </button>\\n        <button type=\"submit\" class=\"cancel btn btn-link\">\\n        <span class=\"fa fa-times\"></span>\\n        Cancel\\n        </button>\\n    '));\n}));\n\nTemplate.__checkName(\"appPropertyEditorField\");\nTemplate[\"appPropertyEditorField\"] = new Template(\"Template.appPropertyEditorField\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"form-group\"\n  }, \"\\n    \", HTML.LABEL({\n    \"for\": function() {\n      return Spacebars.mustache(view.lookup(\"_id\"));\n    }\n  }, Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"title\"));\n  })), \"\\n    \", HTML.SMALL(Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"description\"));\n  }), \" \", HTML.CODE(\"default: \", Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"default\"));\n  }))), \"\\n    \", HTML.INPUT({\n    type: \"text\",\n    \"class\": \"form-control\",\n    id: function() {\n      return Spacebars.mustache(view.lookup(\"_id\"));\n    },\n    placeholder: function() {\n      return Spacebars.mustache(view.lookup(\"default\"));\n    },\n    value: function() {\n      return Spacebars.mustache(view.lookup(\"value\"));\n    }\n  }), \"\\n\");\n}));\n","App.property = function(k) {\n\tvar key = 'property.' + k;\n\tvar prop = App.property.PropertiesCollection.findOne(key);\n\tvar value;\n\tif (!prop) {\n\t\tif (Meteor.isClient) {\n\t\t\tvalue = Session.get(key);\n\t\t} else {\n\t\t\tthrow 'Cannot find App.property: ' + k;\n\t\t}\n\t}\n\tvar postProcessor = App.property.postProcessors[key];\n\tif (postProcessor && prop) {\n\t\tvalue = postProcessor(prop);\n\t} else if (prop) {\n\t\tvalue = prop.value;\n\t}\n\treturn value;\n};\n\nvar defaults = {\n\tkey: 'key',\n\t'default': 1,\n\ttitle: '',\n\tdescription: '',\n\tpostProcessor: function(prop) {\n\t\treturn prop.value;\n\t},\n\tvalidate: function( /* prop */ ) {}\n};\n\nvar dummySubscription = {\n\tready: function() {\n\t\treturn false;\n\t}\n};\n\nApp.component('property').expose({\n\tPropertiesCollection: new Meteor.Collection('properties'),\n\tpostProcessors: [],\n\tvalidators: [],\n\tauthorized: function() {\n\t\treturn true;\n\t},\n\tset: function(obj) {\n\t\tobj = _.extend({}, defaults, obj);\n\t\tobj._id = 'property.' + obj.key;\n\t\tdelete obj.key;\n\t\tApp.property.postProcessors[obj._id] = obj.postProcess;\n\t\tApp.property.validators[obj._id] = obj.validate;\n\t\tvar set = function() {\n\t\t\tif (Meteor.isClient && !App.property.subscription.ready()) {\n\t\t\t\tsetTimeout(set, 100);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar prop = App.property.PropertiesCollection.findOne(obj._id);\n\t\t\tif (prop) {\n\t\t\t\t// console.log('update');\n\t\t\t\tApp.property.PropertiesCollection.update(obj._id, {\n\t\t\t\t\t$set: _.omit(obj, 'key', '_id')\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// console.log('insert');\n\t\t\t\tobj.value = obj['default'];\n\t\t\t\tApp.property.PropertiesCollection.insert(obj);\n\t\t\t}\n\t\t\t// console.log(obj);\n\t\t};\n\t\tset();\n\t},\n\tsubscription: dummySubscription,\n\tinitSubscription: function() {\n\t\t// console.warn('subscribing to properties');\n\t\tApp.property.subscription = Meteor.subscribe('properties');\n\t}\n});\n","Template.appPropertyEditor.helpers({\n\tprops: function() {\n\t\treturn App.property.PropertiesCollection.find({\n\t\t\t_id: /property\\..+/,\n\t\t\treadOnly: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t});\n\t}\n});\nTemplate.appPropertyEditor.events({\n\t'click .save.btn': function(e) {\n\t\te.preventDefault();\n\t\tvar err = false;\n\t\t$(e.currentTarget).parents('form').find('input').each(function() {\n\t\t\tvar val = $(this).val();\n\t\t\tvar id = this.id;\n\t\t\tvar validate = App.property.validators[id];\n\t\t\tif (validate) {\n\t\t\t\tvar prop = App.property.PropertiesCollection.findOne(id);\n\t\t\t\tprop.value = val;\n\t\t\t\ttry {\n\t\t\t\t\tvalidate(prop);\n\t\t\t\t} catch (e) {\n\t\t\t\t\talert('Invalid value for ' + this.id + '\\n' + e);\n\t\t\t\t\terr = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tApp.property.PropertiesCollection.update(id, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: val\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tif (!err && App.property.editFinished) {\n\t\t\tApp.property.editFinished(true);\n\t\t}\n\t},\n\t'click .cancel.btn': function() {\n\t\tif (App.property.editFinished) {\n\t\t\tApp.property.editFinished(false);\n\t\t}\n\t}\n});\nMeteor.startup(function() {\n\tApp.property.initSubscription();\n});\nRouter.waitOn(function() {\n\treturn {\n\t\tready: function() {\n\t\t\treturn App.property.subscription.ready();\n\t\t}\n\t};\n});\n"]}